<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="丁丁爱历险" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="诗和远方 永远存在">
<meta property="og:type" content="website">
<meta property="og:title" content="丁丁爱历险">
<meta property="og:url" content="https://nail2008.github.io/index.html">
<meta property="og:site_name" content="丁丁爱历险">
<meta property="og:description" content="诗和远方 永远存在">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="丁丁爱历险">
<meta name="twitter:description" content="诗和远方 永远存在">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6303676717051430000,
      author: '一丁'
    }
  };
</script>

  <title> 丁丁爱历险 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?a3caff146275475eef00ef79522d8c24";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">丁丁爱历险</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/14/UML-Class-Diagram-Relations/" itemprop="url">
                  UML类图中的关系
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-14T10:16:56+08:00" content="2018-03-14">
              2018-03-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/软件设计/" itemprop="url" rel="index">
                    <span itemprop="name">软件设计</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/14/UML-Class-Diagram-Relations/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/14/UML-Class-Diagram-Relations/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在软件设计过程和源码学习时，经常会用到UML类图。<br>通常对依赖、继承和实现没有什么问题，但正确区分理解关联、组合、聚合的作用和差异常容易搞迷糊。<br>需要说明一下，这篇总结并不是入门，是对关键点或是被忽略的内容的一个总结。主要参考wikipedia上的说明，注意英文版和中文版不太一样，某些说法上不统一，以英文版为准。</p>
<h2 id="UML类图中的关系"><a href="#UML类图中的关系" class="headerlink" title="UML类图中的关系"></a>UML类图中的关系</h2><p><img src="./2018-03-14-UML-Class-Diagram-Relations/umlnotations.png" alt="uml notations"></p>
<h3 id="继承-Inheritance"><a href="#继承-Inheritance" class="headerlink" title="继承 Inheritance"></a>继承 Inheritance</h3><p>继承指的是一个类（称为子类、子接口）继承另外的一个类（称为基类、父类、父接口）的功能，并可以增加它自己的新功能的能力。  </p>
<p>需要提一下常看到的另一个词：泛化（Generalization）</p>
<p>如果说继承是子类向父类继承，那么泛化就是与继承的反方向。比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Animal a = <span class="keyword">new</span> Dog();</div></pre></td></tr></table></figure>
<h3 id="实现-Realization-Implementation"><a href="#实现-Realization-Implementation" class="headerlink" title="实现 Realization/Implementation"></a>实现 Realization/Implementation</h3><p>没啥好说的，理解下面向接口编程、规约这些词的含义就明白为什么要用接口了。</p>
<h3 id="依赖-Dependency"><a href="#依赖-Dependency" class="headerlink" title="依赖 Dependency"></a>依赖 Dependency</h3><p>A uses a B </p>
<p>类A用到了类B，被依赖的对象只是作为一种工具在使用，而并不持有对它的引用。而这种使用关系是具有偶然性、临时性的、单向的、非常弱的，但是B类的变化会影响到A；<br>表现在代码层面，为类B作为参数被类A在某个method（方法）中使用。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 选课服务</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnrollmentService</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> Record <span class="title">enroll</span><span class="params">(Student s, Course c)</span></span>&#123;</div><div class="line">        Record r = <span class="keyword">new</span> Record(s,c);</div><div class="line">        r.save();</div><div class="line">        <span class="keyword">return</span> r;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="关联-Association"><a href="#关联-Association" class="headerlink" title="关联 Association"></a>关联 Association</h3><p>A has a B + 只是用到基本没啥从属关系</p>
<p>关联代表一系列的连接。有四种：双向，单向，聚合（包括合成、聚合）和反射。<br>双向举个例子：机组和航班。<br>其他的后面再说。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Customer customer;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="聚合-Aggregation"><a href="#聚合-Aggregation" class="headerlink" title="聚合 Aggregation"></a>聚合 Aggregation</h3><p>A has a B + 整体——部分 + 但个体独立</p>
<p>聚合是一种关联。聚合是一个较大的“整体”类中包含一个或多个较小的“部分”类的关系。相反，较小的“部分”类是“整个”较大类的一部分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Playlist</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Song&gt; songs;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="组成-组合-合成-Composition"><a href="#组成-组合-合成-Composition" class="headerlink" title="组成/组合/合成 Composition"></a>组成/组合/合成 Composition</h3><p>A has a B + 整体——部分 + ownership 同生共死</p>
<p>组成是一种更强大的关联。“整体”负责创建或销毁其“部分”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apartment</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Room bedroom;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apartment</span><span class="params">()</span> </span>&#123;</div><div class="line">        bedroom = <span class="keyword">new</span> Room();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="关联、聚合、组成的区别"><a href="#关联、聚合、组成的区别" class="headerlink" title="关联、聚合、组成的区别"></a>关联、聚合、组成的区别</h2><p>这里要强调一点，看了不少资料，只有wikipedia和Stack Overflow上明确表达了上面提到过的关系：聚合、组成是两种程度更紧递紧的关联，如下图。我觉得是靠谱的，在中文资料中基本没提到过这个。</p>
<p><img src="2018-03-14-UML-Class-Diagram-Relations/jNyV5.jpg" alt="uml notations"></p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">聚合</th>
<th style="text-align:left">组成</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">生命周期</td>
<td style="text-align:left">各自拥有各自的生命周期</td>
<td style="text-align:left">都使用owner的生命周期</td>
</tr>
<tr>
<td style="text-align:left">子对象</td>
<td style="text-align:left">子对象们都属于一个独立的父对象</td>
<td style="text-align:left">子对象们都属于一个独立的父对象</td>
</tr>
<tr>
<td style="text-align:left">关系</td>
<td style="text-align:left">Has—A</td>
<td style="text-align:left">Owns</td>
</tr>
<tr>
<td style="text-align:left">性质</td>
<td style="text-align:left">collection</td>
<td style="text-align:left">mixture</td>
</tr>
<tr>
<td style="text-align:left">举例</td>
<td style="text-align:left">车和司机</td>
<td style="text-align:left">车和车轮</td>
</tr>
</tbody>
</table>
<p>最后说下个人的一点体会：  </p>
<ol>
<li>三者区别主要在强度上，可以用强度高的表述就不用强度低的表述。</li>
<li>聚合和组成如果分不清的时候不要太纠结，不一定一定能从代码层面分清楚，业务上了解关系就可以了。</li>
<li>关联关系，甚至是聚合关系，通常在类图中不会都展示出来，只展示关键的就行了。比如大雁——雁群这种，不画出来关系也很明确。</li>
<li>读代码更重要的是看抽象（继承、实现），区分聚合和组成其实意义不大。</li>
</ol>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="https://en.wikipedia.org/wiki/Class_diagram" target="_blank" rel="external">wiki英文</a><br><a href="https://zh.wikipedia.org/wiki/%E9%A1%9E%E5%88%A5%E5%9C%96" target="_blank" rel="external">wiki中文</a><br><a href="http://www.uml.org.cn/oobject/201609092.asp" target="_blank" rel="external">UML实践详细经典教程</a><br><a href="https://stackoverflow.com/questions/885937/what-is-the-difference-between-association-aggregation-and-composition" target="_blank" rel="external">What is the difference between association, aggregation and composition?</a><br><a href="http://blog.csdn.net/cjf1002361126/article/details/52750668" target="_blank" rel="external">UML类图java代码实现</a>  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/30/how-to-use-yarn/" itemprop="url">
                  Npm使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-30T10:34:25+08:00" content="2017-09-30">
              2017-09-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/开发工具/" itemprop="url" rel="index">
                    <span itemprop="name">开发工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/09/30/how-to-use-yarn/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/09/30/how-to-use-yarn/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网上的教程"><a href="#网上的教程" class="headerlink" title="网上的教程"></a>网上的教程</h2><ul>
<li><a href="https://yarn.bootcss.com/" target="_blank" rel="external">中文官方</a></li>
<li><a href="http://www.jianshu.com/p/f05eabdf3ab6" target="_blank" rel="external">入门</a></li>
</ul>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="初始化一个新的项目"><a href="#初始化一个新的项目" class="headerlink" title="初始化一个新的项目"></a>初始化一个新的项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn init</div></pre></td></tr></table></figure>
<h3 id="添加一个依赖包"><a href="#添加一个依赖包" class="headerlink" title="添加一个依赖包"></a>添加一个依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yarn add [package]</div><div class="line">yarn add [package]@[version]</div><div class="line">yarn add [package]@[tag]</div></pre></td></tr></table></figure>
<h3 id="更新一个依赖包"><a href="#更新一个依赖包" class="headerlink" title="更新一个依赖包"></a>更新一个依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yarn upgrade [package]</div><div class="line">yarn upgrade [package]@[version]</div><div class="line">yarn upgrade [package]@[tag]</div></pre></td></tr></table></figure>
<h3 id="删除一个依赖包"><a href="#删除一个依赖包" class="headerlink" title="删除一个依赖包"></a>删除一个依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn remove [package]</div></pre></td></tr></table></figure>
<h3 id="安装所有的依赖包"><a href="#安装所有的依赖包" class="headerlink" title="安装所有的依赖包"></a>安装所有的依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn</div></pre></td></tr></table></figure>
<p>or<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn install</div></pre></td></tr></table></figure></p>
<h3 id="查看包信息"><a href="#查看包信息" class="headerlink" title="查看包信息"></a>查看包信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn info react</div></pre></td></tr></table></figure>
<h3 id="升级某个全局包"><a href="#升级某个全局包" class="headerlink" title="升级某个全局包"></a>升级某个全局包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn global upgrade generator-jhipster</div></pre></td></tr></table></figure>
<h2 id="和-npm-对比"><a href="#和-npm-对比" class="headerlink" title="和 npm 对比"></a>和 npm 对比</h2><table>
<thead>
<tr>
<th style="text-align:left">NPM</th>
<th style="text-align:left">YARN</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">npm init</td>
<td style="text-align:left">yarn init</td>
<td style="text-align:left">初始化某个项目</td>
</tr>
<tr>
<td style="text-align:left">npm install/link</td>
<td style="text-align:left">yarn install/link</td>
<td style="text-align:left">默认的安装依赖操作</td>
</tr>
<tr>
<td style="text-align:left">npm install taco —save</td>
<td style="text-align:left">yarn add taco</td>
<td style="text-align:left">安装某个依赖，并且默认保存到package.</td>
</tr>
<tr>
<td style="text-align:left">npm uninstall taco —save</td>
<td style="text-align:left">yarn remove taco</td>
<td style="text-align:left">移除某个依赖项目</td>
</tr>
<tr>
<td style="text-align:left">npm install taco —save-dev</td>
<td style="text-align:left">yarn add taco —dev</td>
<td style="text-align:left">安装某个开发时依赖项目</td>
</tr>
<tr>
<td style="text-align:left">npm update taco —save</td>
<td style="text-align:left">yarn upgrade taco</td>
<td style="text-align:left">更新某个依赖项目</td>
</tr>
<tr>
<td style="text-align:left">npm install taco –global</td>
<td style="text-align:left">yarn global add taco</td>
<td style="text-align:left">安装某个全局依赖项目</td>
</tr>
<tr>
<td style="text-align:left">npm publish/login/logout</td>
<td style="text-align:left">yarn publish/login/logout</td>
<td style="text-align:left">发布/登录/登出，一系列NPM Registry操作</td>
</tr>
<tr>
<td style="text-align:left">npm init</td>
<td style="text-align:left">yarn init</td>
<td style="text-align:left">初始化某个项目</td>
</tr>
<tr>
<td style="text-align:left">npm run/test</td>
<td style="text-align:left">yarn run/test</td>
<td style="text-align:left">运行某个命令，可以在script脚本中去配置</td>
</tr>
</tbody>
</table>
<h2 id="使用淘宝镜像"><a href="#使用淘宝镜像" class="headerlink" title="使用淘宝镜像"></a>使用淘宝镜像</h2><ol>
<li><p>查看当前的源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yarn config get registry</div><div class="line"># -&gt; https://registry.yarnpkg.com</div></pre></td></tr></table></figure>
</li>
<li><p>改成taobao源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yarn config set registry &apos;https://registry.npm.taobao.org&apos;</div><div class="line"></div><div class="line">#yarn config v0.17.3</div><div class="line">#success Set &quot;registry&quot; to &quot;https://#registry.npm.taobao.org&quot;.</div><div class="line">#✨  Done in 0.06s.</div></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/01/how-to-explain-sql/" itemprop="url">
                  Oracle执行计划
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-01T17:54:33+08:00" content="2017-08-01">
              2017-08-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/08/01/how-to-explain-sql/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/08/01/how-to-explain-sql/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">--set autotrace on;</span></div><div class="line"></div><div class="line"><span class="comment">--Session级别启用收集</span></div><div class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> STATISTICS_LEVEL = ALL; <span class="comment">-- 捕捉下一次执行SQL的执行信息</span></div><div class="line"></div><div class="line"><span class="keyword">select</span> d.dept_name,u.user_name <span class="keyword">from</span> sy_org_user u ,sy_org_dept d</div><div class="line"><span class="keyword">where</span> u.dept_code = d.dept_code;</div><div class="line"></div><div class="line"><span class="comment">-- 参数:SQL_ID,Child number,Format,</span></div><div class="line"><span class="comment">--select * from table(SYS.DBMS_XPLAN.DISPLAY_CURSOR(null,null,'ADVANCED ALLSTATS LAST PEEKED_BINDS'));</span></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span>(SYS.DBMS_XPLAN.DISPLAY_CURSOR(<span class="string">'bkx0s41y98z0c'</span>,<span class="literal">null</span>,<span class="string">'ADVANCED ALLSTATS LAST PEEKED_BINDS'</span>));</div><div class="line"></div><div class="line"><span class="comment">-- 下面讲解这三个参数的获取</span></div><div class="line"></div><div class="line">    <span class="comment">-- 获取SQL_ID,通过sql_text,获得相应的SQL_ID,这里为bkx0s41y98z0c</span></div><div class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> v$SQLAREA <span class="keyword">where</span> sql_text <span class="keyword">like</span> <span class="string">'select d.dept_name,u.user_name from sy_org_user u ,sy_org_dept d%'</span>;</div><div class="line">    </div><div class="line">    <span class="comment">-- 获取Child number,一般指定为null,获取所有的子游标.如果要特别获取,使用以下方式:</span></div><div class="line">        <span class="comment">-- 父游标</span></div><div class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> v$SQLAREA <span class="keyword">where</span> sql_id = <span class="string">'bkx0s41y98z0c'</span>;</div><div class="line">        </div><div class="line">        <span class="comment">-- 子游标:执行计划和优化环境</span></div><div class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> v$<span class="keyword">SQL</span> <span class="keyword">where</span> SQL_id = <span class="string">'bkx0s41y98z0c'</span>;</div><div class="line">        <span class="comment">-- 计划:</span></div><div class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> v$SQL_PLAN <span class="keyword">where</span> SQL_id = <span class="string">'bkx0s41y98z0c'</span> ;</div><div class="line">        <span class="comment">-- 优化环境:</span></div><div class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> v$SQL_OPTIMIZER_ENV <span class="keyword">where</span> SQL_id = <span class="string">'bkx0s41y98z0c'</span>;</div><div class="line">    </div><div class="line">    <span class="comment">-- 设置Format: 可以选ALLSTATS=IOSTATS+MEMSTATS</span></div><div class="line">       <span class="comment">-- IOSTATS 显示该游标累计执行的IO统计信息(Buffers, Reads)</span></div><div class="line">       <span class="comment">-- MEMSTATS 累计执行的PGA使用信息(Omem 1Mem Used-Mem)</span></div><div class="line">       <span class="comment">-- LAST 仅显示最后一次执行的统计信息</span></div><div class="line">       <span class="comment">-- Advanced 显示outline\Query Block Name\Column Projection等信息</span></div><div class="line">       <span class="comment">-- PEEKED_BINDS 打印解析时使用的绑定变量</span></div><div class="line">       <span class="comment">-- Typical 不打印PROJECTION,ALIAS</span></div><div class="line">       </div><div class="line">       </div><div class="line"><span class="comment">-- 语句级别收集</span></div><div class="line"><span class="keyword">select</span> <span class="comment">/*+ gather_plan_statistics*/</span> d.dept_name,u.user_name <span class="keyword">from</span> sy_org_user u ,sy_org_dept d</div><div class="line"><span class="keyword">where</span> u.dept_code = d.dept_code;</div><div class="line"><span class="comment">--收集all stats有额外的负载,结束后需要回设成默认值:</span></div><div class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> STATISTICS_LEVEL=TYPICAL;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/13/start-docker/" itemprop="url">
                  开始使用Docker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-13T14:12:46+08:00" content="2017-07-13">
              2017-07-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务端/" itemprop="url" rel="index">
                    <span itemprop="name">服务端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/07/13/start-docker/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/13/start-docker/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Docker-for-Mac"><a href="#Docker-for-Mac" class="headerlink" title="Docker for Mac"></a>Docker for Mac</h3><p>OSX 10.10以后在Mac上使用Docker变得极简单（不需要装虚拟机及其linux），下载安装即可。</p>
<p><a href="https://store.docker.com/editions/community/docker-ce-desktop-mac?tab=description" target="_blank" rel="external">官网下载</a></p>
<p><a href="http://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/?spm=a2c1q.8351553.0.0.468c7ecboTpw2I" target="_blank" rel="external">阿里云下载</a></p>
<h2 id="使用阿里加速器"><a href="#使用阿里加速器" class="headerlink" title="使用阿里加速器"></a>使用阿里加速器</h2><ol>
<li>注册<a href="https://account.aliyun.com/" target="_blank" rel="external">阿里云开发者账号</a></li>
<li>进入<a href="https://cr.console.aliyun.com/?spm=5176.100239.blogcont29941.12.R6mUIX#/accelerator" target="_blank" rel="external">Docker Hub 镜像站点</a></li>
<li>记住<code>您的专属加速器地址</code></li>
<li>打开Docker for Mac。Preferences–&gt;Daemon–&gt;Basic–&gt;Registry mirrors，点+，将你的地址贴到这里。然后Apply&amp;Restart。</li>
</ol>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker version</div></pre></td></tr></table></figure>
<h3 id="搜索可用docker镜像"><a href="#搜索可用docker镜像" class="headerlink" title="搜索可用docker镜像"></a>搜索可用docker镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker search 镜像名字</div></pre></td></tr></table></figure>
<h3 id="下载容器镜像"><a href="#下载容器镜像" class="headerlink" title="下载容器镜像"></a>下载容器镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull 用户名/镜像名</div></pre></td></tr></table></figure>
<h3 id="运行容器里的命令"><a href="#运行容器里的命令" class="headerlink" title="运行容器里的命令"></a>运行容器里的命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run 用户名/镜像名 命令........</div></pre></td></tr></table></figure>
<h3 id="在容器中安装新的程序（ubuntu环境）"><a href="#在容器中安装新的程序（ubuntu环境）" class="headerlink" title="在容器中安装新的程序（ubuntu环境）"></a>在容器中安装新的程序（ubuntu环境）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run 用户名/镜像名 apt-get install -y 程序名</div></pre></td></tr></table></figure>
<h3 id="查看容器信息"><a href="#查看容器信息" class="headerlink" title="查看容器信息"></a>查看容器信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker ps -l</div></pre></td></tr></table></figure>
<p>查询到的信息如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</div><div class="line">029e4b87152e        learn/tutorial      &quot;apt-get install -...&quot;   37 seconds ago      Exited (0) 33 seconds ago                       dazzling_dijkstra</div></pre></td></tr></table></figure></p>
<h3 id="保存对容器的修改"><a href="#保存对容器的修改" class="headerlink" title="保存对容器的修改"></a>保存对容器的修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker commit 容器ID前3-4位 用户名/新的镜像名</div></pre></td></tr></table></figure>
<p>这里有一个镜像的基本概念，我们用<code>docker run</code>对容器进行操作，有一些会改变它里面的状态、内容。<br>如果不commit的，下次启动容器，这些状态就丢失了。所以如果有状态变化，后面一定记得commit，保存镜像。</p>
<h3 id="检查运行中的镜像"><a href="#检查运行中的镜像" class="headerlink" title="检查运行中的镜像"></a>检查运行中的镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker inspect efe</div></pre></td></tr></table></figure>
<h3 id="发布docker镜像"><a href="#发布docker镜像" class="headerlink" title="发布docker镜像"></a>发布docker镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker push 用户名/镜像名</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://www.docker.org.cn/" target="_blank" rel="external">Docker中文</a><br><a href="http://blog.csdn.net/hubinqiang/article/details/55113706" target="_blank" rel="external">Docker安装（在Macbook中安装Docker）后配置阿里云加速器</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/11/start-rabbitmq/" itemprop="url">
                  在Mac上安装RabbitMQ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-11T14:24:41+08:00" content="2017-07-11">
              2017-07-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务端/" itemprop="url" rel="index">
                    <span itemprop="name">服务端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/07/11/start-rabbitmq/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/11/start-rabbitmq/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>mac下使用Homebrew安装   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install rabbitmq</div></pre></td></tr></table></figure>
<p><img src="2017-07-11-start-rabbitmq/install.png" alt="install.png"></p>
<p>默认安装至<code>/usr/local/opt/rabbitmq</code>     </p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><h3 id="配置自启动"><a href="#配置自启动" class="headerlink" title="配置自启动"></a>配置自启动</h3><p>见上图两条命令行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">配置开机自启动:</div><div class="line">  ln -sfv /usr/local/opt/rabbitmq/*.plist ~/Library/LaunchAgents</div><div class="line">然后启动它:</div><div class="line">  launchctl load ~/Library/LaunchAgents/homebrew.mxcl.rabbitmq.plist</div></pre></td></tr></table></figure></p>
<h3 id="手动启动"><a href="#手动启动" class="headerlink" title="手动启动"></a>手动启动</h3><p>当然我们的mac不是服务器，开发时使用下面的手动启动就可以了</p>
<p>安装目录下，通过以下命令启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sbin/rabbitmq-server</div></pre></td></tr></table></figure></p>
<p>启动后服务默认占用5672端口，管理端web在15672端口</p>
<h2 id="web管理页面"><a href="#web管理页面" class="headerlink" title="web管理页面"></a>web管理页面</h2><p>管理页面默认地址：<code>http://localhost:15672</code><br>管理端默认账号：guest/guest</p>
<p>注意这个账号是admin权限的。</p>
<p>有了这个图形化界面，创建用户、分权限啥的就不用敲命令了，想了解命令行的使用请查看参考资料，里面有说。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://www.rabbitmq.com/install-standalone-mac.html" target="_blank" rel="external">官方mac环境安装说明</a><br><a href="https://jingyan.baidu.com/article/e4d08ffd9ec61c0fd2f60d1f.html" target="_blank" rel="external">图解RabbitMQ安装与配置</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/07/dir-is-not-owned-by-mysql/" itemprop="url">
                  启动 mysql 失败 Warning:The /usr/local/mysql/data directory is not owned by the 'mysql' or '_mysql'
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-07T09:32:48+08:00" content="2017-07-07">
              2017-07-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/07/07/dir-is-not-owned-by-mysql/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/07/dir-is-not-owned-by-mysql/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Warning:The /usr/local/mysql/data directory is not owned by the ‘mysql’ or ‘_mysql’</p>
<p>这应该是某种情况下导致/usr/local/mysql/data的宿主发生了改变。</p>
<p>解决方法：</p>
<p>打开终端运行 sudo chown -R mysql /usr/local/mysql/data 即可。</p>
<p>mac 下运行  sudo chown -R  _mysql:wheel  /usr/local/mysql/data 。</p>
<p>　　-c 显示更改的部分的信息</p>
<p>　　-f 忽略错误信息</p>
<p>　　-h 修复符号链接</p>
<p>　　-R 处理指定目录以及其子目录下的所有文件</p>
<p>　　-v 显示详细的处理信息</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/19/arch-based-redis/" itemprop="url">
                  基于redis的服务架构（未成文）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-19T16:51:16+08:00" content="2017-06-19">
              2017-06-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务端/" itemprop="url" rel="index">
                    <span itemprop="name">服务端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/19/arch-based-redis/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/19/arch-based-redis/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文探索Redis在企业服务架构中的作用，目前仅收集资料，后期总结心得，逐步完善知识体系。</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><a href="http://blog.sina.com.cn/s/blog_4680937f0102wsdj.html" target="_blank" rel="external">Redis/Twisted系统整合 </a><br><a href="https://cloud.baidu.com/product/tsdb.html?track=cp:nsem|pf:pc|pp:tsdb|pu:tsdb|ci:|kw:59248" target="_blank" rel="external">时序数据库</a>  </p>
<p><a href="http://www.cnblogs.com/langtianya/p/4902461.html" target="_blank" rel="external">在云上搭建大规模实时数据流处理系统</a><br><a href="http://www.cnblogs.com/meslog/p/5180510.html" target="_blank" rel="external">通过Netty通信，采集设备现场GPS数据,并存放在redis服务器</a><br><a href="https://my.oschina.net/u/438393/blog/845527" target="_blank" rel="external">Netty傻瓜教程（五）：不能不谈Redis</a><br><a href="http://www.cnblogs.com/agent-k/p/Redis.html" target="_blank" rel="external">Redis在游戏服务器中的应用</a><br><a href="https://www.aliyun.com/product/kvstore?spm=5176.7114037.746101.1.uqLJwB" target="_blank" rel="external">阿里云redis</a>  </p>
<p><a href="https://www.zhihu.com/question/20795043" target="_blank" rel="external">redis怎么做消息队列？</a></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p><a href="http://blog.csdn.net/mindfloating/article/details/50381978" target="_blank" rel="external">Redis 的性能幻想与残酷现实</a>  </p>
<p>知乎问题：<br>如何解决redis高并发客户端频繁time out？<br>现在业务上每天有5亿+的请求，平时redis的操作在2K+每秒左右。到了高峰有3K+，这时候客户端就会频繁的报connect time out的异常。<br>但是，资料上说redis可以达到10W每秒。3K远远不到w这个级别啊，请问有什么建议优化现在的情况么？   </p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><a href="http://www.importnew.com/19321.html" target="_blank" rel="external">Jedis对redis的操作详解</a><br><a href="http://www.cnblogs.com/liuling/p/2014-4-19-04.html" target="_blank" rel="external">Java中使用Jedis操作Redis</a>  </p>
<p><a href="https://www.aliyun.com/zixun/content/2_62_1883753.html" target="_blank" rel="external">使用Redis之前5个必须了解的事情</a><br><a href="http://blog.csdn.net/opensure/article/details/51375961" target="_blank" rel="external">redis3.2新功能–GEO地理位置命令介绍</a><br><a href="http://blog.csdn.net/jone_lu/article/details/50772014" target="_blank" rel="external">redis 常用整理</a>  </p>
<h2 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h2><p><a href="http://hello-nick-xu.iteye.com/category/314998" target="_blank" rel="external">Hello_Nick_Xu的redis系列文章</a>  </p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><p><a href="https://www.oschina.net/search?scope=project&amp;q=redis" target="_blank" rel="external">各种redis相关项目-oschina</a>  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/19/mysql-merge-partition/" itemprop="url">
                  MySql merge分表
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-19T16:46:36+08:00" content="2017-06-19">
              2017-06-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务端/" itemprop="url" rel="index">
                    <span itemprop="name">服务端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/19/mysql-merge-partition/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/19/mysql-merge-partition/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySql的存储引擎"><a href="#MySql的存储引擎" class="headerlink" title="MySql的存储引擎"></a>MySql的存储引擎</h2><h3 id="常用的几种引擎类型："><a href="#常用的几种引擎类型：" class="headerlink" title="常用的几种引擎类型："></a>常用的几种引擎类型：</h3><ol>
<li>InnoDB 是业务系统里最常用的，支持事务处理，不支持全文本搜索</li>
<li>MyISAM 性能极高的一个引擎，支持全文本搜索，但不支持事务处理</li>
<li>MEMORY 功能等同于MyISAM，但数据存储在内存中，速度更快，适合于临时表</li>
</ol>
<h3 id="InnoDB和MyISAM的区别："><a href="#InnoDB和MyISAM的区别：" class="headerlink" title="InnoDB和MyISAM的区别："></a>InnoDB和MyISAM的区别：</h3><ol>
<li>MySQL默认采用的是MyISAM。  </li>
<li>MyISAM不支持事务，而InnoDB支持。InnoDB的AUTOCOMMIT默认是打开的，即每条SQL语句会默认被封装成一个事务，自动提交，这样会影响速度，所以最好是把多条SQL语句显示放在begin和commit之间，组成一个事务去提交。  </li>
<li>InnoDB支持数据行锁定，MyISAM不支持行锁定，只支持锁定整个表。即MyISAM同一个表上的读锁和写锁是互斥的，MyISAM并发读写时如果等待队列中既有读请求又有写请求，默认写请求的优先级高，即使读请求先到，所以MyISAM不适合于有大量查询和修改并存的情况，那样查询进程会长时间阻塞。因为MyISAM是锁表，所以某项读操作比较耗时会使其他写进程饿死。  </li>
<li>InnoDB支持外键，MyISAM不支持。    </li>
<li>InnoDB的主键范围更大，最大是MyISAM的2倍。   </li>
<li>InnoDB不支持全文索引，而MyISAM支持。全文索引是指对char、varchar和text中的每个词（停用词除外）建立倒排序索引。MyISAM的全文索引其实没啥用，因为它不支持中文分词，必须由使用者分词后加入空格再写到数据表里，而且少于4个汉字的词会和停用词一样被忽略掉。   </li>
<li>MyISAM支持GIS数据，InnoDB不支持。即MyISAM支持以下空间数据对象：Point,Line,Polygon,Surface等。   </li>
<li>没有where的count(<em>)使用MyISAM要比InnoDB快得多。因为MyISAM内置了一个计数器，count(</em>)时它直接从计数器中读，而InnoDB必须扫描全表。所以在InnoDB上执行count(<em>)时一般要伴随where，且where中要包含主键以外的索引列。为什么这里特别强调“主键以外”？因为InnoDB中primary index是和raw data存放在一起的，而secondary index则是单独存放，然后有个指针指向primary key。所以只是count(</em>)的话使用secondary index扫描更快，而primary key则主要在扫描索引同时要返回raw data时的作用较大。  </li>
</ol>
<h2 id="merge分表策略"><a href="#merge分表策略" class="headerlink" title="merge分表策略"></a>merge分表策略</h2><ol>
<li>使用merge的话，数据插入策略只能存在FIRST或LAST一张表里，分表策略自然只能选择按时间。</li>
<li>mysql单表不要超过500万数据。我们目前巡线轨迹数据30秒一条，一天按12小时算，单用户一天1440条数据。如果按天，单表支持3472个用户；如果按月（31天）单表支持112个用户。单表极限用户数（30秒1条，1天10小时）。当然都是比较理想的情况，实际可以等当前表差不多到500万了，再加新表。</li>
</ol>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>不需要改代码。</li>
<li>数据库改动小，也很灵活。<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4></li>
<li>merge只能用在mysql，oracle用的是按范围分区，也可以达到类似的效果。其他数据库暂未研究。</li>
</ul>
<h3 id="一般步骤"><a href="#一般步骤" class="headerlink" title="一般步骤"></a>一般步骤</h3><ol>
<li>merge简介分表就是把N条记录的表，分成若干个分表，各个分表记录的总和仍为N。<br>分表的方法有很多，用merge来分表，是最简单的一种方式.merge是mysql的一种存储引擎，它把一组MyISAM数据表当做一个逻辑单元.<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t`</span> (</div><div class="line">  <span class="string">`id`</span>   <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">  <span class="string">`data`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">)</div><div class="line">  <span class="keyword">ENGINE</span> = <span class="keyword">MERGE</span></div><div class="line">  <span class="keyword">UNION</span> = (t1, t2)</div><div class="line">  INSERT_METHOD = <span class="keyword">LAST</span>;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>其中ENGINE = MERGE表示，使用merge引擎。另外ENGINE = MRG_MyISAM是一样的意思。UNION = (t1, t2)表示，挂接了t1,<br>t2表INSERT_METHOD = LAST表示，插入方式。0不允许插入，FIRST插入到UNION中的第一个表，LAST插入到UNION中的最后一个表.</p>
<ol>
<li>merge数据存储结构mysql中MyISAM引擎下每一张表都对应三个文件: .MYD数据文件，.MYI索引文件，.frm表结构文件.但是Merge引擎下每一张表只有一个.MRG文件.MRG里面存放着分表的关系，以及插入数据的方式。它就像是一个外壳，或者是连接池,<br>数据存放在分表里面.</li>
</ol>
<h3 id="一个完整的例子"><a href="#一个完整的例子" class="headerlink" title="一个完整的例子"></a>一个完整的例子</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`cdp_gps_record_old`</span> (</div><div class="line">  <span class="string">`ID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</div><div class="line">  <span class="string">`TASKRECORDID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'巡线记录ID，外键'</span>,</div><div class="line">  <span class="string">`LONGITUDE`</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'经度，原始坐标'</span>,</div><div class="line">  <span class="string">`LATITUDE`</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'纬度，原始坐标'</span>,</div><div class="line">  <span class="string">`X`</span> <span class="built_in">decimal</span>(<span class="number">20</span>,<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'投影X'</span>,</div><div class="line">  <span class="string">`Y`</span> <span class="built_in">decimal</span>(<span class="number">20</span>,<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'投影Y'</span>,</div><div class="line">  <span class="string">`SPEED`</span> <span class="built_in">decimal</span>(<span class="number">8</span>,<span class="number">0</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'速度'</span>,</div><div class="line">  <span class="string">`OPM_ID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'巡线工ID，外键'</span>,</div><div class="line">  <span class="string">`TIME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'时间'</span>,</div><div class="line">  <span class="string">`SAVETIME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'入库存储时间'</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'实时记录数据old'</span>;</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`cdp_gps_record_now`</span> (</div><div class="line">  <span class="string">`ID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</div><div class="line">  <span class="string">`TASKRECORDID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'巡线记录ID，外键'</span>,</div><div class="line">  <span class="string">`LONGITUDE`</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'经度，原始坐标'</span>,</div><div class="line">  <span class="string">`LATITUDE`</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'纬度，原始坐标'</span>,</div><div class="line">  <span class="string">`X`</span> <span class="built_in">decimal</span>(<span class="number">20</span>,<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'投影X'</span>,</div><div class="line">  <span class="string">`Y`</span> <span class="built_in">decimal</span>(<span class="number">20</span>,<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'投影Y'</span>,</div><div class="line">  <span class="string">`SPEED`</span> <span class="built_in">decimal</span>(<span class="number">8</span>,<span class="number">0</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'速度'</span>,</div><div class="line">  <span class="string">`OPM_ID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'巡线工ID，外键'</span>,</div><div class="line">  <span class="string">`TIME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'时间'</span>,</div><div class="line">  <span class="string">`SAVETIME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'入库存储时间'</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'实时记录数据now'</span>;</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`cdp_gps_record`</span> (</div><div class="line">  <span class="string">`ID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'主键'</span>,</div><div class="line">  <span class="string">`TASKRECORDID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'巡线记录ID，外键'</span>,</div><div class="line">  <span class="string">`LONGITUDE`</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'经度，原始坐标'</span>,</div><div class="line">  <span class="string">`LATITUDE`</span> <span class="built_in">decimal</span>(<span class="number">12</span>,<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'纬度，原始坐标'</span>,</div><div class="line">  <span class="string">`X`</span> <span class="built_in">decimal</span>(<span class="number">20</span>,<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'投影X'</span>,</div><div class="line">  <span class="string">`Y`</span> <span class="built_in">decimal</span>(<span class="number">20</span>,<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'投影Y'</span>,</div><div class="line">  <span class="string">`SPEED`</span> <span class="built_in">decimal</span>(<span class="number">8</span>,<span class="number">0</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'速度'</span>,</div><div class="line">  <span class="string">`OPM_ID`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'巡线工ID，外键'</span>,</div><div class="line">  <span class="string">`TIME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'时间'</span>,</div><div class="line">  <span class="string">`SAVETIME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'入库存储时间'</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span> = MRG_MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 INSERT_METHOD=<span class="keyword">LAST</span> <span class="keyword">COMMENT</span>=<span class="string">'实时记录数据总表'</span></div><div class="line"><span class="keyword">UNION</span> =(<span class="string">`cdp_gps_record_old`</span>,<span class="string">`cdp_gps_record_now`</span>);</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://www.cnblogs.com/zhangchaoyang/articles/4214237.html" target="_blank" rel="external">MyISAM和InnoDB的区别</a><br><a href="http://www.cnblogs.com/lyl2016/p/5797519.html" target="_blank" rel="external">MyISAM和InnoDB的区别</a>   </p>
<p><a href="http://blog.csdn.net/xifeijian/article/details/20316775" target="_blank" rel="external">MySQL存储引擎–MyISAM与InnoDB区别</a>  </p>
<p><a href="https://segmentfault.com/a/1190000002675986" target="_blank" rel="external">MySQL使用方案</a><br><a href="https://segmentfault.com/q/1010000002678260" target="_blank" rel="external">如果单表的数据达到300万，是否考虑分表？</a><br><a href="http://blog.csdn.net/wushangjimo/article/details/40112517" target="_blank" rel="external">Mysql分表查询引擎Merge技术总结</a><br><a href="http://www.cnblogs.com/whoamme/archive/2013/03/13/2958531.html" target="_blank" rel="external">mysql分表方法—–MRG_MyISAM引擎分表法</a></p>
<p><a href="http://www.cnblogs.com/andy6/p/6238512.html" target="_blank" rel="external">oracle数据分表使用实例</a>    </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/16/distributed-ehcache-with-jgroups/" itemprop="url">
                  Ehcache使用JGroups做组播集群
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-16T16:19:05+08:00" content="2017-06-16">
              2017-06-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务端/" itemprop="url" rel="index">
                    <span itemprop="name">服务端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/16/distributed-ehcache-with-jgroups/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/16/distributed-ehcache-with-jgroups/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="关于缓存的几点小想法"><a href="#关于缓存的几点小想法" class="headerlink" title="关于缓存的几点小想法"></a>关于缓存的几点小想法</h2><p>开篇先跑跑题。最近在研究集群环境下的缓存同步问题，Web开发领域常见的几种缓存技术：Ehcache、Redis和memcached。<br>Ehcache是我们现在用的，它的最大优点是它是纯Java的，跟应用跑在同一个JVM里，不存在传输上的开销；<br>Redis在用作缓存时常同memcached对比，我们知道他可以做缓存服务之外，其实他本身是个数据库，甚至自身就可以做消息队列。  </p>
<p>从Ehcache、Redis中的测试报告来看，都说自己更快，这是因为他们都偷换了概念，以己之长比别人的短处。<br>Ehcache长处在JVM运行，但这只是单点，跟Redis比单点肯定有优势。免费方案只能考虑做组播，组播对网络环境要求较高，而且如果集群节点很多，组播次数呈级数上升，形成组播风暴，可用性很差。<br>Redis单点可能比不过Ehcache，但可以集中或集群式部署缓存服务，供分布式系统中的其他业务服务使用。各个节点采用订阅模式，当某一节点相关缓存更新，通知Redis，Redis在发布给订阅的节点更新缓存。有多少节点就发多少次。</p>
<p>这里不做过多发散，直接说我的小想法——用Ehcache和Redis做二级缓存。<br>Ehcache做一级缓存，查询优先从这里查数据，如果没有再去二级缓存Redis上查找，如果还没有，再去数据库查询。</p>
<p>但是很不幸。。已经有人这么做过了——<a href="https://www.oschina.net/p/j2cache" target="_blank" rel="external">J2Cache</a><br>思路一致，不过好像太监了。1.3版都没提交中心库。</p>
<h2 id="Ehcache使用JGroups做组播集群"><a href="#Ehcache使用JGroups做组播集群" class="headerlink" title="Ehcache使用JGroups做组播集群"></a>Ehcache使用JGroups做组播集群</h2><p>那既然组播有缺点，为啥还要写这个呢？因为如果你只是做2-3个节点的负载均衡，其实这东西还是靠谱的，又由于很多资料不靠谱，我觉得还是把我梳理的写出来。</p>
<p>跑题结束，下面说正事。</p>
<h3 id="jar依赖添加"><a href="#jar依赖添加" class="headerlink" title="jar依赖添加"></a>jar依赖添加</h3><p><a href="http://www.jgroups.org/manual/index.html#Requirements" target="_blank" rel="external">jgroups官方文档2.1节</a>中有如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">2.1. Requirements</div><div class="line">JGroups up to (and including) 3.5.0.Final requires JDK 6.</div><div class="line"></div><div class="line">JGroups 3.6.x to (excluding) 4.0 requires JDK 7.</div><div class="line"></div><div class="line">JGroups 4.0 will require JDK 8.</div><div class="line"></div><div class="line">There is no JNI code present so JGroups should run on all platforms.</div><div class="line"></div><div class="line">Logging: by default, JGroups tries to use log4j2. If the classes are not found on the classpath, it resorts to log4j, and if still not found, it falls back to java.util.logging logger. See Logging for details on log configuration.</div></pre></td></tr></table></figure></p>
<ul>
<li>3.6.0（不含）以下的版本需要JDK6   </li>
<li>3.6.x 以上到4.0（不含）需要JDK7   </li>
<li>4.0以上的需要JDK8  </li>
<li>需要log4j或者log4j2</li>
</ul>
<p>比如，我们的一个项目依赖如下：<br>JDK6<br>ehcache-core-2.6.11.jar<br>jgroups-3.5.1.Final.jar  </p>
<p>另外还需要下面这个jar包，用来整合jgroups和ehcache，点击可以下载：<br><a href="http://mvnrepository.com/artifact/net.sf.ehcache/ehcache-jgroupsreplication/1.7" target="_blank" rel="external">ehcache-jgroupsreplication-1.7.jar</a></p>
<p>最后还有一些jar包：<br>slf4j-api-1.6.6.jar<br>slf4j-jdk14-1.6.6.jar<br>log4j-1.2.13.jar</p>
<h3 id="组播策略"><a href="#组播策略" class="headerlink" title="组播策略"></a>组播策略</h3><p>组播策略是我们在编写配置文件前需要考虑的问题，我们选择的是<code>通知失效策略</code>。<br>即各节点独立维护自己的缓存，当一个节点的某缓存发生变化时，并不将改变化同步复制到其他节点。而是通知其他节点清除该缓存。</p>
<p>选择这种策略的原因是我们的应用服务器在Nginx上使用了<code>IP哈希策略</code>，一个设备的用户请求会固定由一个应用服务器处理。这种情况下，<br>很多数据是不用在其他节点缓存具体数据的，只在自己的节点有就行，使用<code>通知失效策略</code>减小了同步缓存的开销。</p>
<p>而ehcache可以对不同的数据配置不同的策略，比如<code>在线用户名单</code>之类的全局数据我们依然可以使用同步复制的策略，保持各节点下该缓存的数据是一致的。</p>
<h3 id="集群策略"><a href="#集群策略" class="headerlink" title="集群策略"></a>集群策略</h3><p>一开始我们用了两台机器，不在同一个网段。采用UDP，自动发现的情况下没有问题；但是采用TCP，指定IP的时候就死活不成功，直到挪到同一台，不同端口才成功。（没试同一网段，以后再说。）</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>需要修改ehcache配置文件<code>ehcache.xml</code>，我还把jgroups的配置文件独立了出来，所以还要新建一个<code>jgroups_tcp.xml</code>。  </p>
<h4 id="jgroups-tcp-xml"><a href="#jgroups-tcp-xml" class="headerlink" title="jgroups_tcp.xml"></a><code>jgroups_tcp.xml</code></h4><p>官方默认配置例子在jar包里的<code>tcp.xml</code>。下面的例子只修改了两个应用的ip及端口（bind_port、initial_hosts配置），如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--</span></div><div class="line">    TCP based stack, with flow control and message bundling. This is usually used when IP</div><div class="line">    multicasting cannot be used in a network, e.g. because it is disabled (routers discard multicast).</div><div class="line">    Note that TCP.bind_addr and TCPPING.initial_hosts should be set, possibly via system properties, e.g.</div><div class="line">    -Djgroups.bind_addr=192.168.5.2 and -Djgroups.tcpping.initial_hosts=192.168.5.2[7800]</div><div class="line">    author: Bela Ban</div><div class="line">--&gt;</div><div class="line"><span class="tag">&lt;<span class="name">config</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">        <span class="attr">xmlns</span>=<span class="string">"urn:org:jgroups"</span></div><div class="line">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"urn:org:jgroups http://www.jgroups.org/schema/jgroups.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TCP</span> <span class="attr">bind_port</span>=<span class="string">"40000"</span></span></div><div class="line">         <span class="attr">recv_buf_size</span>=<span class="string">"$&#123;tcp.recv_buf_size:5M&#125;"</span></div><div class="line">         <span class="attr">send_buf_size</span>=<span class="string">"$&#123;tcp.send_buf_size:5M&#125;"</span></div><div class="line">         <span class="attr">max_bundle_size</span>=<span class="string">"64K"</span></div><div class="line">         <span class="attr">max_bundle_timeout</span>=<span class="string">"30"</span></div><div class="line">         <span class="attr">use_send_queues</span>=<span class="string">"true"</span></div><div class="line">         <span class="attr">sock_conn_timeout</span>=<span class="string">"300"</span></div><div class="line"></div><div class="line">         <span class="attr">timer_type</span>=<span class="string">"new3"</span></div><div class="line">         <span class="attr">timer.min_threads</span>=<span class="string">"4"</span></div><div class="line">         <span class="attr">timer.max_threads</span>=<span class="string">"10"</span></div><div class="line">         <span class="attr">timer.keep_alive_time</span>=<span class="string">"3000"</span></div><div class="line">         <span class="attr">timer.queue_max_size</span>=<span class="string">"500"</span></div><div class="line"></div><div class="line">         <span class="attr">thread_pool.enabled</span>=<span class="string">"true"</span></div><div class="line">         <span class="attr">thread_pool.min_threads</span>=<span class="string">"2"</span></div><div class="line">         <span class="attr">thread_pool.max_threads</span>=<span class="string">"8"</span></div><div class="line">         <span class="attr">thread_pool.keep_alive_time</span>=<span class="string">"5000"</span></div><div class="line">         <span class="attr">thread_pool.queue_enabled</span>=<span class="string">"true"</span></div><div class="line">         <span class="attr">thread_pool.queue_max_size</span>=<span class="string">"10000"</span></div><div class="line">         <span class="attr">thread_pool.rejection_policy</span>=<span class="string">"discard"</span></div><div class="line"></div><div class="line">         <span class="attr">oob_thread_pool.enabled</span>=<span class="string">"true"</span></div><div class="line">         <span class="attr">oob_thread_pool.min_threads</span>=<span class="string">"1"</span></div><div class="line">         <span class="attr">oob_thread_pool.max_threads</span>=<span class="string">"8"</span></div><div class="line">         <span class="attr">oob_thread_pool.keep_alive_time</span>=<span class="string">"5000"</span></div><div class="line">         <span class="attr">oob_thread_pool.queue_enabled</span>=<span class="string">"false"</span></div><div class="line">         <span class="attr">oob_thread_pool.queue_max_size</span>=<span class="string">"100"</span></div><div class="line">         <span class="attr">oob_thread_pool.rejection_policy</span>=<span class="string">"discard"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TCPPING</span> <span class="attr">async_discovery</span>=<span class="string">"true"</span></span></div><div class="line">             <span class="attr">initial_hosts</span>=<span class="string">"$&#123;jgroups.tcpping.initial_hosts:localhost[40000],localhost[40001]&#125;"</span></div><div class="line">             <span class="attr">port_range</span>=<span class="string">"1"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">MERGE3</span>  <span class="attr">min_interval</span>=<span class="string">"10000"</span></span></div><div class="line">             <span class="attr">max_interval</span>=<span class="string">"30000"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">FD_SOCK</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">FD</span> <span class="attr">timeout</span>=<span class="string">"3000"</span> <span class="attr">max_tries</span>=<span class="string">"3"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">VERIFY_SUSPECT</span> <span class="attr">timeout</span>=<span class="string">"1500"</span>  /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">BARRIER</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pbcast.NAKACK2</span> <span class="attr">use_mcast_xmit</span>=<span class="string">"false"</span></span></div><div class="line">                    <span class="attr">discard_delivered_msgs</span>=<span class="string">"true"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">UNICAST3</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pbcast.STABLE</span> <span class="attr">stability_delay</span>=<span class="string">"1000"</span> <span class="attr">desired_avg_gossip</span>=<span class="string">"50000"</span></span></div><div class="line">                   <span class="attr">max_bytes</span>=<span class="string">"4M"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">pbcast.GMS</span> <span class="attr">print_local_addr</span>=<span class="string">"true"</span> <span class="attr">join_timeout</span>=<span class="string">"2000"</span></span></div><div class="line">                <span class="attr">view_bundling</span>=<span class="string">"true"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">MFC</span> <span class="attr">max_credits</span>=<span class="string">"2M"</span></span></div><div class="line">         <span class="attr">min_threshold</span>=<span class="string">"0.4"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">FRAG2</span> <span class="attr">frag_size</span>=<span class="string">"60K"</span>  /&gt;</span></div><div class="line">    <span class="comment">&lt;!--RSVP resend_interval="2000" timeout="10000"/--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pbcast.STATE_TRANSFER</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="ehcache-xml"><a href="#ehcache-xml" class="headerlink" title="ehcache.xml"></a><code>ehcache.xml</code></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">		 <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"ehcache.xsd"</span> <span class="attr">updateCheck</span>=<span class="string">"false"</span></div><div class="line">		 <span class="attr">monitoring</span>=<span class="string">"autodetect"</span> <span class="attr">dynamicConfig</span>=<span class="string">"false"</span>&gt;</div><div class="line">	<span class="comment">&lt;!--start count --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">defaultCache</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"100000"</span> <span class="attr">eternal</span>=<span class="string">"true"</span></span></div><div class="line">				  <span class="attr">overflowToDisk</span>=<span class="string">"false"</span> <span class="attr">diskSpoolBufferSizeMB</span>=<span class="string">"30"</span> <span class="attr">maxElementsOnDisk</span>=<span class="string">"10000000"</span></div><div class="line">				  <span class="attr">diskPersistent</span>=<span class="string">"false"</span> <span class="attr">statistics</span>=<span class="string">"true"</span></div><div class="line">				  <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">"120"</span> <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">terracotta</span> <span class="attr">clustered</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 默认采用失效通知策略，各节点独立维护自己的缓存，缓存发生变化时，通知其他节点清除 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">cacheEventListenerFactory</span></span></div><div class="line">				<span class="attr">class</span>=<span class="string">"net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"</span></div><div class="line">				<span class="attr">properties</span>=<span class="string">"replicateAsynchronously=true, replicatePuts=false, replicateUpdates=false,</span></div><div class="line">			replicateUpdatesViaCopy=false, replicateRemovals=true "/&gt;</div><div class="line">		<span class="comment">&lt;!-- cacheEventListenerFactory属性properties说明 --&gt;</span></div><div class="line">		<span class="comment">&lt;!--</span></div><div class="line">		replicateAsynchronously : 对象同步是否异步完成，默认为true。如果比较紧急就设为false。</div><div class="line">		                          在一致性时间性要求不强的时候，设为异步可大大提供性能，因为它是异步立即返回的，而且可以批量提交。</div><div class="line">		replicateUpdatesViaCopy : 是否将对象变更复制到所有节点，还是只是发送一个失效信息，让对方该缓存失效，当对方需要该缓存时重新计算载入。</div><div class="line">		                          默认为true。鉴于对象复制的消耗挺大的，又有锁的问题，而且对方也未必需要该对象，所以此属性建议设为false。</div><div class="line">		                          如果业务上真的需要设为true时，就可考虑使用Terracotta了。</div><div class="line">		replicatePuts : 增加对象时是否同步，默认为true，如果replicateUpdatesViaCopy为false，选择了失效算法，所以replicatePuts 要设为false。</div><div class="line">		replicateUpdates : 修改对象时是否同步，默认为true。</div><div class="line">		replicateRemovals : 删除对象时是否同步，默认为true。</div><div class="line">		 --&gt;</div><div class="line">	<span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 单独设置菜单的缓存，单个菜单文件100KB，避免上万登录用户全部缓存，一般设定为并发用户数1000-2000 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"SY_ORG_USER__MENU"</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"1000"</span></span></div><div class="line">		   <span class="attr">eternal</span>=<span class="string">"true"</span> <span class="attr">overflowToDisk</span>=<span class="string">"false"</span> <span class="attr">statistics</span>=<span class="string">"true"</span></div><div class="line">		   <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span> &gt;</div><div class="line">		<span class="comment">&lt;!-- 缓存集群同步策略：各节点独立，不同步 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">cacheEventListenerFactory</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"</span></div><div class="line">		<span class="attr">properties</span>=<span class="string">"replicateAsynchronously=true, replicatePuts=false, replicateUpdates=false,</span></div><div class="line">		replicateUpdatesViaCopy=false, replicateRemovals=false "/&gt;</div><div class="line">	<span class="tag">&lt;/<span class="name">cache</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 单独设置页面缓存，缓存时间5分钟一刷新 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"SimplePageCachingFilter"</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"2000"</span></span></div><div class="line">		   <span class="attr">eternal</span>=<span class="string">"false"</span> <span class="attr">overflowToDisk</span>=<span class="string">"false"</span> <span class="attr">timeToIdleSeconds</span>=<span class="string">"300"</span></div><div class="line">		   <span class="attr">timeToLiveSeconds</span>=<span class="string">"300"</span> <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LFU"</span> &gt;</div><div class="line">		<span class="comment">&lt;!-- 缓存集群同步策略：各节点独立，不同步 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">cacheEventListenerFactory</span></span></div><div class="line">				<span class="attr">class</span>=<span class="string">"net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"</span></div><div class="line">				<span class="attr">properties</span>=<span class="string">"replicateAsynchronously=true, replicatePuts=false, replicateUpdates=false,</span></div><div class="line">			replicateUpdatesViaCopy=false, replicateRemovals=false "/&gt;</div><div class="line">	<span class="tag">&lt;/<span class="name">cache</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!--在线用户--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"ONLINE_USER"</span> <span class="attr">maxElementsInMemory</span>=<span class="string">"50000"</span></span></div><div class="line">		   <span class="attr">eternal</span>=<span class="string">"true"</span> <span class="attr">overflowToDisk</span>=<span class="string">"false"</span> <span class="attr">statistics</span>=<span class="string">"true"</span> <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LFU"</span>&gt;</div><div class="line">		<span class="comment">&lt;!-- 缓存集群同步策略：各节点随时保持同步 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">cacheEventListenerFactory</span></span></div><div class="line">			<span class="attr">class</span>=<span class="string">"net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"</span></div><div class="line">			<span class="attr">properties</span>=<span class="string">"replicateAsynchronously=true, replicatePuts=true, replicateUpdates=true,</span></div><div class="line">			replicateUpdatesViaCopy=true, replicateRemovals=true "/&gt;</div><div class="line">	<span class="tag">&lt;/<span class="name">cache</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 集群 JGroup设置 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">cacheManagerPeerProviderFactory</span> <span class="attr">class</span>=<span class="string">"net.sf.ehcache.distribution.jgroups.JGroupsCacheManagerPeerProviderFactory"</span></span></div><div class="line">        <span class="attr">properties</span>=<span class="string">"jgroups_tcp.xml"</span> /&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- ehcache monitor --&gt;</span></div><div class="line">	<span class="comment">&lt;!--&lt;cacheManagerPeerListenerFactory class="org.terracotta.ehcachedx.monitor.probe.ProbePeerListenerFactory"--&gt;</span></div><div class="line">	<span class="comment">&lt;!--								 properties="monitorAddress=localhost, monitorPort=9889, memoryMeasurement=true"/&gt;--&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="配置VM-OPTIONS"><a href="#配置VM-OPTIONS" class="headerlink" title="配置VM OPTIONS"></a>配置VM OPTIONS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-Dfile.encoding=UTF-8           // 解决console中文乱码</div><div class="line">-Djgroups.bind_addr=192.168.6.28            // jgroups基本配置</div><div class="line">-Djgroups.tcpping.initial_hosts=192.168.6.28[40000]     // jgroups基本配置</div><div class="line">-Djava.net.preferIPv4Stack=true</div></pre></td></tr></table></figure>
<p>前三个没什么好说的，第四个如果没有，服务启动可能会报错，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[2017-05-27 09:55:01.128]&lt;TransferQueueBundler,EH_CACHE,duanyidingdeMacBook-Pro-41155&gt;[WARN ] JGRP000034: duanyidingdeMacBook-Pro-41155: failure sending message to /ff0e:0:0:0:0:8:8:8: java.io.IOException: No route to host (received 7 identical messages from /ff0e:0:0:0:0:8:8:8 in the last 76445 ms) [] org.jgroups.util.SuppressLog.log(SuppressLog.java:47)</div></pre></td></tr></table></figure>
<p>原因：<br><a href="https://gist.github.com/rafaeltuelho/208568668e4205bd9b93" target="_blank" rel="external">https://gist.github.com/rafaeltuelho/208568668e4205bd9b93</a><br><a href="http://colky.iteye.com/blog/1188408" target="_blank" rel="external">http://colky.iteye.com/blog/1188408</a>  </p>
<h3 id="调试和监控"><a href="#调试和监控" class="headerlink" title="调试和监控"></a>调试和监控</h3><h4 id="ehcache-debugger-1-7-1-jar"><a href="#ehcache-debugger-1-7-1-jar" class="headerlink" title="ehcache-debugger-1.7.1.jar"></a><code>ehcache-debugger-1.7.1.jar</code></h4><p><a href="http://www.ehcache.org/documentation/2.8/operations/remotedebugger.html" target="_blank" rel="external">http://www.ehcache.org/documentation/2.8/operations/remotedebugger.html</a><br>上面这篇是官方文档，下载到这个jar包，然后执行下面的命令，就可以监控具体缓存了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">例子：java -jar ehcache-debugger-1.7.1.jar ./../ehcache.xml _CACHE_C_OA_QJ_TYPE_DICT</div><div class="line">格式：java -jar ehcache-debugger-1.7.1.jar ehcache配置文件路径 缓存NAME（可选）</div></pre></td></tr></table></figure></p>
<p>然后你就可以看到哗哗的日志了。</p>
<h4 id="Debug断点"><a href="#Debug断点" class="headerlink" title="Debug断点"></a>Debug断点</h4><p>在类JGroupsCacheReceiver的receive方法打断点，可以监控节点获取组播消息的情况。</p>
<h4 id="Ehcache-Monitor"><a href="#Ehcache-Monitor" class="headerlink" title="Ehcache-Monitor"></a>Ehcache-Monitor</h4><p>安装见：<a href="https://nail2008.github.io/2017/05/17/how-to-use-ehcache-monitor/">Ehcache-Monitor</a></p>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="http://www.jgroups.org/manual/index.html" target="_blank" rel="external">JGroups官方文档</a></p>
<p>几篇不错的blog：<br><a href="http://blog.csdn.net/kindy1022/article/details/6681299" target="_blank" rel="external">http://blog.csdn.net/kindy1022/article/details/6681299</a><br><a href="https://my.oschina.net/u/866380/blog/501082" target="_blank" rel="external">https://my.oschina.net/u/866380/blog/501082</a><br><a href="http://www.cnblogs.com/fangfan/p/4042823.html" target="_blank" rel="external">http://www.cnblogs.com/fangfan/p/4042823.html</a><br><a href="http://blog.csdn.net/tengdazhang770960436/article/details/49947383" target="_blank" rel="external">http://blog.csdn.net/tengdazhang770960436/article/details/49947383</a>  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/how-to-use-ehcache-monitor/" itemprop="url">
                  Ehcache Monitor 安装及使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-17T16:47:36+08:00" content="2017-05-17">
              2017-05-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务端/" itemprop="url" rel="index">
                    <span itemprop="name">服务端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/17/how-to-use-ehcache-monitor/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/17/how-to-use-ehcache-monitor/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.ehcache.org/" target="_blank" rel="external">Ehcache</a>是Java常用的缓存方案，由于直接运行在JVM里，所以还是有很多场合是Redis无法替代的。</p>
<p>监控Ehcache的手段比较单一，只有Ehcache-Monitor，当然也有<a href="http://blog.csdn.net/wiker_yong/article/details/52068420" target="_blank" rel="external">自己实现的方法</a>。</p>
<p>查看了不少相关资料，很多链接都不好使了，因为Ehcache的官网改版了。而且似乎刻意去掉了Monitor的信息，官方下载也没有了。</p>
<p>以下是我找到的1.0.3版下载地址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://terracotta.org/downloads/open-source/destination?name=ehcache-monitor-kit-1.0.3-distribution.tar.gz&amp;bucket=tcdistributions&amp;file=ehcache-monitor-kit-1.0.3-distribution.tar.gz</div></pre></td></tr></table></figure></p>
<p>看README.txt这货针对不同Ehcache不同版本使用方法可能有区别，貌似各版本都能用。我使用的是2.5.1，使用正常。</p>
<p>安装方法最详细的还是官方pdf文档，中文的可以看下面两篇：<br><a href="http://hck.iteye.com/blog/1732660" target="_blank" rel="external">http://hck.iteye.com/blog/1732660</a><br><a href="http://www.yuananan.cn/html/article/AR64m1684VKax5Ahhp53gp.html" target="_blank" rel="external">http://www.yuananan.cn/html/article/AR64m1684VKax5Ahhp53gp.html</a></p>
<p>注意注释掉启动文件<code>ehcache-monitor-kit-1.0.3\bin\startup.bat</code>里：<code>-j %PRGDIR%\etc\jetty.xml ^</code>行。</p>
<p>官方参考：<br><a href="http://www.ehcache.org/documentation/ehcache-2.5.x-documentation.pdf" target="_blank" rel="external">http://www.ehcache.org/documentation/ehcache-2.5.x-documentation.pdf</a><br><a href="http://blog.trifork.com/2009/12/22/using-ehcache-monitor/" target="_blank" rel="external">http://blog.trifork.com/2009/12/22/using-ehcache-monitor/</a>  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/blue-logo.jpg"
               alt="一丁" />
          <p class="site-author-name" itemprop="name">一丁</p>
          <p class="site-description motion-element" itemprop="description">诗和远方 永远存在</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">35</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/nail2008" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一丁</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"nail2008"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
